<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: EmIL: Embedded Infrastructure Library</title>
    <link rel="canonical" href="https://philips-software.github.io/embeddedinfralib/embedded_infrastructure_library/1.3.0/NetworkConnections.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://philips-software.github.io/embeddedinfralib">EmIL: Embedded Infrastructure Library</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="embedded_infrastructure_library" data-version="1.3.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Embedded Infrastructure Library documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="MemoryRange.html">MemoryRange</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Containers.html">Containers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Echo.html">Echo</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="NetworkConnections.html">NetworkConnections</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Embedded Infrastructure Library documentation</span>
    <span class="version">1.3.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Embedded Infrastructure Library documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.3.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Embedded Infrastructure Library documentation</a></li>
    <li><a href="NetworkConnections.html">NetworkConnections</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/philips-software/embeddedinfralib/edit/feature/antora-doc-generation/documents/modules/ROOT/pages/NetworkConnections.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_network_connections"><a class="anchor" href="#_network_connections"></a>Network Connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The data sent over TCP and similar streaming connections are handled via
Connection and ConnectionObserver objects. A Connection object
represents the network towards which data is sent or received, a
ConnectionObserver represents the application side handling sent or
received data. For example, the C++ wrapper for Lightweight IP provides
a class ConnectionLwIP which derives from Connection; the HttpClientImpl
class derives from ConnectionObserver, since HttpClientImpl interprets
received data, parses HTTP headers, and forwards body data.</p>
</div>
<div class="paragraph">
<p>The lifetime of a Connection/ConnectionObserver pair is under control of
the network stack, since the network stacks knows when a connection is
alive and when it is terminated. The Connection object therefore derives
from SharedOwnedObserver, which holds a SharedPtr to its
SharedOwningSubject, which is the ConnectionObserver. When a connection
is closed, the Connection object is destructed, and thereby releases its
control over its ConnectionObserver, which typically results in the
ConnectionObserver being destructed.</p>
</div>
<div class="paragraph">
<p>@startuml</p>
</div>
<div class="literalblock">
<div class="content">
<pre>class SharedOwnedObserver {
    +bool IsAttached() const
    +SharedOwningSubject&amp; Subject() const
    +void Detach()
    +{abstract}void Attached() {}
    +{abstract}void Detaching() {}
    -SharedOwningSubject* subject
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>class SharedOwningSubject {
    -SharedPtr&lt;SharedOwnedObserver&gt; observer
    +void Attach(const SharedPtr&lt;SharedOwnedObserver&gt;&amp; observer)
    +void Detach()
    +bool IsAttached() const
    +SharedOwnedObserver&amp; Observer() const
    +SharedPtr&lt;SharedOwnedObserver&gt; ObserverPtr() const
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>class ConnectionObserver{
    +{abstract}void SendStreamAvailable(SharedPtr&lt;StreamWriter&gt;&amp;&amp; streamWriter)
    +{abstract}void DataReceived()
    +{abstract}void Close() {...}
    +{abstract}void Abort() {...}
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>class Connection {
    +{abstract}void RequestSendStream(std::size_t sendSize)
    +{abstract}std::size_t MaxSendStreamSize() const
    +{abstract}SharedPtr&lt;StreamReaderWithRewinding&gt; ReceiveStream()
    +{abstract}void AckReceived()
    +{abstract}void CloseAndDestroy()
    +{abstract}void AbortAndDestroy()
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>SharedOwnedObserver &lt;|-- ConnectionObserver
SharedOwningSubject &lt;|-- Connection
SharedOwnedObserver -left- SharedOwningSubject : &lt; owns</pre>
</div>
</div>
<div class="paragraph">
<p>@enduml</p>
</div>
<div class="paragraph">
<p>The methods on Connection and ConnectionObserver for sending and
receiving data are geared towards asynchronous behaviour and as little
copying as possible. By having fully asynchronous behaviour, the need
for threads and/or blocking waits is completely avoided, and one
application can easily handle multiple connections, in parallel with SPI
transfers, UART communication, etc. without the need for locks or
wasting MCU time on busy waits.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
